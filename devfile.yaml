schemaVersion: 2.2.0
metadata:
  name: systemd-nested
components:
  - name: universal-developer-image
    container:
      image: registry.redhat.io/devspaces/udi-rhel9:latest
      command: ['/sbin/init']
      env:
        - name: KUBEDOCK_ENABLED
          value: 'false'
      volumeMounts:
        - name: cgroups-host
          path: /sys/fs/cgroup
    attributes:
      container-overrides:
        securityContext:
          privileged: true
          runAsUser: 0
          runAsNonRoot: false
          # Adding these to ensure SELinux doesn't block systemd
          seLinuxOptions:
            type: spc_t 
  - name: cgroups-host
    volume: {}
attributes:
  pod-overrides:
    spec:
      # We explicitly set the Pod-level security context to NULL
      # to prevent it from forcing the 'project-clone' to use the 
      # high-range UID (1000820000) we saw in your previous logs.
      securityContext:
        fsGroup: 0
        runAsUser: 0
      volumes:
        - name: cgroups-host
          hostPath:
            path: /sys/fs/cgroup
            type: Directory
